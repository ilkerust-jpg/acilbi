<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>acilbi</title>
<style>
body{font-family:system-ui;background:#fff;color:#111;text-align:center;padding:18px}
input,button,select{width:100%;padding:14px;margin-top:10px;font-size:16px;border-radius:8px}
button{background:#111;color:#fff;border:none}
.panel{display:none;margin-top:15px;text-align:left;background:#f3f3f3;padding:12px;border-radius:10px}
.warn{background:#ffefc2;padding:10px;border-left:4px solid #e6a700;border-radius:6px;margin-top:10px}
hr{margin:30px 0}
</style>
</head>
<body>

<h2>acilbi</h2>

<div id="accessPanel">
  <p id="helpText">Bu kişi yardıma ihtiyaç duyabilir.</p>
  <div class="warn">Şifre: <b id="visiblePin"></b></div>
  <button id="btnAccess">Bilgileri Göster</button>
</div>

<div id="infoPanel" class="panel"></div>

<hr>

<div id="setupPanel" class="panel" style="display:none">
  <h3>Bilgi Girişi (Sahip)</h3>

  <select id="langSelect">
    <option value="tr">Türkçe</option>
    <option value="en">English</option>
  </select>

  <input id="nameInput" placeholder="Ad Soyad">
  <input id="telInput" placeholder="Acil Kişi Telefon">
  <button onclick="saveData()">Kaydet</button>
</div>

<script>
const API = "https://acilbi-api.ilkerust.workers.dev";
const params = new URLSearchParams(location.search);
const id = params.get("id");

document.getElementById("visiblePin").innerText = id || "";

if(location.search.includes("setup=1")){
  document.getElementById("setupPanel").style.display="block";
}

const texts = {
  tr: {
    help: "Bu kişi yardıma ihtiyaç duyabilir.",
    show: "Bilgileri Göster",
    notFound: "Bilgi bulunamadı",
    emergency: "Acil Kişi",
    call: "Ara",
    saved: "Kaydedildi!"
  },
  en: {
    help: "This person may need help.",
    show: "Show Information",
    notFound: "No information found",
    emergency: "Emergency Contact",
    call: "Call",
    saved: "Saved!"
  }
};

document.getElementById("btnAccess").onclick = async ()=>{
  const res = await fetch(`${API}?id=${id}`);
  const data = await res.json();

  if(!data.name){
    alert("Bilgi bulunamadı");
    return;
  }

  const lang = data.lang || "tr";
  const t = texts[lang];

  document.getElementById("helpText").innerText = t.help;
  document.getElementById("btnAccess").innerText = t.show;

  const panel = document.getElementById("infoPanel");
  panel.style.display="block";
  panel.innerHTML = `
    <h3>${data.name}</h3>
    <p><b>${t.emergency}:</b> ${data.emTel}</p>
    <button onclick="location.href='tel:${data.emTel}'">${t.call}</button>
  `;
};

async function saveData(){
  const name = document.getElementById("nameInput").value;
  const tel = document.getElementById("telInput").value;
  const lang = document.getElementById("langSelect").value;

  await fetch(`${API}?id=${id}`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ name:name, emTel:tel, lang:lang })
  });

  alert(texts[lang].saved);
}
</script>

</body>
</html>
