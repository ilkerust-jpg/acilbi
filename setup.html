<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Acilbi ‚Äì Sahip Bilgi Giri≈üi</title>
<style>
body{font-family:system-ui;background:#f4f4f4;margin:0;padding:18px}
.card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
input,select,button{width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:8px;border:1px solid #ccc}
button{background:#111;color:#fff;border:none;font-weight:600}
button:disabled{opacity:.6}
.small{font-size:14px;color:#666;margin-top:10px}
.ok{color:green}
.err{color:red}
label{display:block;margin-top:10px;font-size:14px;color:#444;font-weight:600}
</style>
</head>
<body>

<div class="card">
  <h2 id="hTitle">üìù Sahip Bilgi Giri≈üi</h2>
  <div id="hDesc" class="small">Bileklik bilgilerini doldurun</div>

  <!-- Dil se√ßimi -->
  <label id="lblLang" for="lang">Dil</label>
  <select id="lang">
    <option value="tr">T√ºrk√ße (TR)</option>
    <option value="en">English (EN)</option>
    <option value="de">Deutsch (DE)</option>
    <option value="ru">–†—É—Å—Å–∫–∏–π (RU)</option>
  </select>

  <input id="ownerPass" placeholder="Kutudan √ßƒ±kan sahip ≈üifresi">
  <input id="name" placeholder="Ad Soyad">

  <label id="lblBirth" for="birthYear">Doƒüum Yƒ±lƒ±</label>
  <select id="birthYear"></select>

  <label id="lblBlood" for="blood">Kan Grubu</label>
  <select id="blood">
    <option value="">Kan Grubu Se√ßin</option>
    <option>0 Rh+</option>
    <option>0 Rh-</option>
    <option>A Rh+</option>
    <option>A Rh-</option>
    <option>B Rh+</option>
    <option>B Rh-</option>
    <option>AB Rh+</option>
    <option>AB Rh-</option>
  </select>

  <input id="illness" placeholder="Kronik Rahatsƒ±zlƒ±klar">
  <input id="meds" placeholder="Rutin ƒ∞la√ßlar">
  <input id="allergy" placeholder="Alerjiler">
  <input id="emergency" placeholder="Acil Ki≈üi Telefon">

  <button id="saveBtn" onclick="save()">Bilgileri Kaydet</button>
  <div id="status" class="small"></div>
</div>

<script>
  // ---- √áEVƒ∞Rƒ∞ S√ñZL√úƒû√ú ----
  const I18N = {
    tr: {
      title: "üìù Sahip Bilgi Giri≈üi",
      desc: "Bileklik bilgilerini doldurun",
      lang: "Dil",
      ownerPass: "Kutudan √ßƒ±kan sahip ≈üifresi",
      name: "Ad Soyad",
      birth: "Doƒüum Yƒ±lƒ±",
      blood: "Kan Grubu",
      bloodPick: "Kan Grubu Se√ßin",
      illness: "Kronik Rahatsƒ±zlƒ±klar",
      meds: "Rutin ƒ∞la√ßlar",
      allergy: "Alerjiler",
      emergency: "Acil Ki≈üi Telefon",
      save: "Bilgileri Kaydet",
      saving: "Kaydediliyor...",
      saved: "‚úÖ Bilgiler kaydedildi",
      idMissing: "ID bulunamadƒ±",
      netErr: "Baƒülantƒ± hatasƒ±"
    },
    en: {
      title: "üìù Owner Information",
      desc: "Fill in the wristband information",
      lang: "Language",
      ownerPass: "Owner password (from the box)",
      name: "Full Name",
      birth: "Birth Year",
      blood: "Blood Type",
      bloodPick: "Select blood type",
      illness: "Chronic Conditions",
      meds: "Medications",
      allergy: "Allergies",
      emergency: "Emergency Phone",
      save: "Save Information",
      saving: "Saving...",
      saved: "‚úÖ Saved successfully",
      idMissing: "ID not found",
      netErr: "Network error"
    },
    de: {
      title: "üìù Besitzerinformationen",
      desc: "Bitte Armbanddaten ausf√ºllen",
      lang: "Sprache",
      ownerPass: "Besitzer-Passwort (aus der Box)",
      name: "Name",
      birth: "Geburtsjahr",
      blood: "Blutgruppe",
      bloodPick: "Blutgruppe w√§hlen",
      illness: "Chronische Erkrankungen",
      meds: "Medikamente",
      allergy: "Allergien",
      emergency: "Notfall-Telefon",
      save: "Speichern",
      saving: "Wird gespeichert...",
      saved: "‚úÖ Erfolgreich gespeichert",
      idMissing: "ID nicht gefunden",
      netErr: "Netzwerkfehler"
    },
    ru: {
      title: "üìù –î–∞–Ω–Ω—ã–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞",
      desc: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –±—Ä–∞—Å–ª–µ—Ç–∞",
      lang: "–Ø–∑—ã–∫",
      ownerPass: "–ü–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–∏–∑ –∫–æ—Ä–æ–±–∫–∏)",
      name: "–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è",
      birth: "–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è",
      blood: "–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏",
      bloodPick: "–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –∫—Ä–æ–≤–∏",
      illness: "–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è",
      meds: "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞",
      allergy: "–ê–ª–ª–µ—Ä–≥–∏–∏",
      emergency: "–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏",
      save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
      saving: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...",
      saved: "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",
      idMissing: "ID –Ω–µ –Ω–∞–π–¥–µ–Ω",
      netErr: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"
    }
  }

  // ---- ID ----
  const params = new URLSearchParams(location.search)
  const id = params.get("id")

  // ---- Doƒüum yƒ±lƒ± dropdown ----
  const year = new Date().getFullYear()
  const birthSel = document.getElementById("birthYear")
  for(let i=year;i>=1920;i--){
    birthSel.insertAdjacentHTML("beforeend", `<option value="${i}">${i}</option>`)
  }

  // ---- Dil tahmini ----
  function guessLang(){
    const q = (params.get("lang")||"").toLowerCase()
    if (["tr","en","de","ru"].includes(q)) return q

    const al = (navigator.language || "tr").toLowerCase()
    if (al.startsWith("de")) return "de"
    if (al.startsWith("ru")) return "ru"
    if (al.startsWith("en")) return "en"
    return "tr"
  }

  const langSelect = document.getElementById("lang")
  langSelect.value = guessLang()

  function applyLang(code){
    const t = I18N[code] || I18N.tr

    document.documentElement.lang = code
    document.getElementById("hTitle").innerText = t.title
    document.getElementById("hDesc").innerText  = t.desc
    document.getElementById("lblLang").innerText = t.lang
    document.getElementById("lblBirth").innerText = t.birth
    document.getElementById("lblBlood").innerText = t.blood

    document.getElementById("ownerPass").placeholder = t.ownerPass
    document.getElementById("name").placeholder = t.name
    document.getElementById("illness").placeholder = t.illness
    document.getElementById("meds").placeholder = t.meds
    document.getElementById("allergy").placeholder = t.allergy
    document.getElementById("emergency").placeholder = t.emergency
    document.getElementById("saveBtn").innerText = t.save

    // blood default option text
    const blood = document.getElementById("blood")
    if (blood && blood.options && blood.options.length > 0) {
      blood.options[0].text = t.bloodPick
    }
  }

  // ilk uygulama
  applyLang(langSelect.value)

  // deƒüi≈üince uygula
  langSelect.addEventListener("change", () => applyLang(langSelect.value))

  async function save(){
    const status = document.getElementById("status")
    const btn = document.getElementById("saveBtn")
    const code = langSelect.value
    const t = I18N[code] || I18N.tr

    if(!id){
      status.className="small err"
      status.innerText = t.idMissing
      return
    }

    btn.disabled = true
    status.className="small"
    status.innerText = t.saving

    const data = {
      lang: code,
      ownerPass: document.getElementById("ownerPass").value.trim(),
      name: document.getElementById("name").value.trim(),
      birthYear: document.getElementById("birthYear").value,
      blood: document.getElementById("blood").value,
      illness: document.getElementById("illness").value.trim(),
      meds: document.getElementById("meds").value.trim(),
      allergy: document.getElementById("allergy").value.trim(),
      emergency: document.getElementById("emergency").value.trim()
    }

    try{
      const res = await fetch("https://acilbi.com/save?id="+id,{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(data)
      })

      const text = await res.text()

      if(res.ok){
        status.className="small ok"
        status.innerText = t.saved
      }else{
        status.className="small err"
        status.innerText = text || "Error"
      }
    }catch(e){
      status.className="small err"
      status.innerText = t.netErr
    }

    btn.disabled = false
  }
</script>

</body>
</html>
