<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>acilbi – Sahip Girişi</title>
<style>
body{font-family:system-ui;background:#fff;color:#111;padding:18px;margin:0;text-align:center}
.panel{background:#f3f3f3;padding:14px;border-radius:10px;margin-top:14px;text-align:left}
input,select,textarea{width:100%;padding:10px;margin-top:8px;font-size:15px;border-radius:6px;border:1px solid #444}
button{width:100%;padding:16px;margin-top:12px;font-size:18px;border:none;border-radius:10px;background:#111;color:#fff}
.success{background:#dff0d8;padding:10px;border-radius:6px;margin-top:10px}
.error{background:#f8d7da;padding:10px;border-radius:6px;margin-top:10px}
</style>
</head>
<body>

<h2>acilbi</h2>
<p>Bileklik Sahibi Girişi</p>

<div class="panel">
<label>Bileklik Kodu</label>
<input id="idInput" placeholder="Örn: GE4F2">

<label>Sahip Şifresi</label>
<input id="passInput" type="password" placeholder="Kutudan çıkan şifre">

<button onclick="loadData()">Bilgileri Yükle</button>
<div id="msg"></div>
</div>

<div id="formPanel" class="panel" style="display:none">
<h3>Kişi Bilgileri</h3>

<label>Ad Soyad</label>
<input id="name">

<label>Doğum Yılı</label>
<select id="birthYear"></select>

<label>Kan Grubu</label>
<select id="blood">
<option value="">Seçiniz</option>
<option>A+</option><option>A-</option>
<option>B+</option><option>B-</option>
<option>AB+</option><option>AB-</option>
<option>0+</option><option>0-</option>
</select>

<label>Kronik Rahatsızlıklar</label>
<textarea id="chronic"></textarea>

<label>Rutin İlaçlar</label>
<textarea id="meds"></textarea>

<label>Alerjiler</label>
<textarea id="allergy"></textarea>

<label>Acil Kişi Telefon</label>
<input id="emTel">

<button onclick="saveData()">Kaydet</button>
<div id="saveMsg"></div>
</div>

<script>
const api = "https://acilbi.com";

for(let y=new Date().getFullYear(); y>=1920; y--){
  const opt=document.createElement("option");
  opt.value=y; opt.text=y;
  birthYear.appendChild(opt);
}

async function loadData(){
  const id=idInput.value.trim();
  const pass=passInput.value.trim();
  msg.innerHTML="";

  if(!id || !pass){
    msg.innerHTML='<div class="error">Kod ve şifre gerekli</div>';
    return;
  }

  const res = await fetch(api+"/"+id+"?pass="+pass);
  const data = await res.json();

  if(!data.ok){
    msg.innerHTML='<div class="error">Kod veya şifre hatalı</div>';
    return;
  }

  formPanel.style.display="block";

  name.value=data.user.name||"";
  birthYear.value=data.user.birthYear||"";
  blood.value=data.user.blood||"";
  chronic.value=data.user.chronic||"";
  meds.value=data.user.meds||"";
  allergy.value=data.user.allergy||"";
  emTel.value=data.user.emTel||"";

  msg.innerHTML='<div class="success">Bilgiler yüklendi</div>';
}

async function saveData(){
  const id=idInput.value.trim();
  const pass=passInput.value.trim();

  const payload={
    pass,
    name:name.value,
    birthYear:birthYear.value,
    blood:blood.value,
    chronic:chronic.value,
    meds:meds.value,
    allergy:allergy.value,
    emTel:emTel.value
  };

  const res = await fetch(api+"/"+id,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  const data = await res.json();

  if(data.ok){
    saveMsg.innerHTML='<div class="success">Bilgiler kaydedildi</div>';
  }else{
    saveMsg.innerHTML='<div class="error">Şifre hatalı</div>';
  }
}
</script>

</body>
</html>
