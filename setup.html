<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Acilbi ‚Äì Sahip Bilgi Giri≈üi</title>
<style>
body{font-family:system-ui;background:#f4f4f4;margin:0;padding:18px}
.card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
input,select,button{width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:8px;border:1px solid #ccc}
button{background:#111;color:#fff;border:none;font-weight:600}
button:disabled{opacity:.6}
.small{font-size:14px;color:#666;margin-top:10px}
.ok{color:green}
.err{color:red}
</style>
</head>
<body>

<div class="card">
<h2>üìù Sahip Bilgi Giri≈üi</h2>
<div class="small">Bileklik bilgilerini doldurun</div>

<!-- ‚úÖ Dil se√ßimi -->
<select id="lang">
  <option value="tr">T√ºrk√ße (TR)</option>
  <option value="en">English (EN)</option>
  <option value="de">Deutsch (DE)</option>
  <option value="ru">–†—É—Å—Å–∫–∏–π (RU)</option>
</select>

<input id="ownerPass" placeholder="Kutudan √ßƒ±kan sahip ≈üifresi">
<input id="name" placeholder="Ad Soyad">

<select id="birthYear"></select>

<select id="blood">
<option value="">Kan Grubu Se√ßin</option>
<option>0 Rh+</option>
<option>0 Rh-</option>
<option>A Rh+</option>
<option>A Rh-</option>
<option>B Rh+</option>
<option>B Rh-</option>
<option>AB Rh+</option>
<option>AB Rh-</option>
</select>

<input id="illness" placeholder="Kronik Rahatsƒ±zlƒ±klar">
<input id="meds" placeholder="Rutin ƒ∞la√ßlar">
<input id="allergy" placeholder="Alerjiler">
<input id="emergency" placeholder="Acil Ki≈üi Telefon">

<button id="saveBtn" onclick="save()">Bilgileri Kaydet</button>
<div id="status" class="small"></div>
</div>

<script>
// Doƒüum yƒ±lƒ± dropdown
const year = new Date().getFullYear()
for(let i=year;i>=1920;i--){
  document.getElementById("birthYear")
    .insertAdjacentHTML("beforeend", `<option value="${i}">${i}</option>`)
}

// URL'den ID al
const params = new URLSearchParams(location.search)
const id = params.get("id")

// Dil varsayƒ±lan: URL ?lang= varsa onu al, yoksa tarayƒ±cƒ±dan tahmin et
function guessLang(){
  const q = (params.get("lang")||"").toLowerCase()
  if(["tr","en","de","ru"].includes(q)) return q
  const al = (navigator.language||"tr").toLowerCase()
  if(al.startsWith("de")) return "de"
  if(al.startsWith("ru")) return "ru"
  if(al.startsWith("en")) return "en"
  return "tr"
}
document.getElementById("lang").value = guessLang()

async function save(){
  const status = document.getElementById("status")
  const btn = document.getElementById("saveBtn")

  if(!id){
    status.className="small err"
    status.innerText="ID bulunamadƒ±"
    return
  }

  btn.disabled = true
  status.className="small"
  status.innerText="Kaydediliyor..."

  const data = {
    lang: document.getElementById("lang").value,            // ‚úÖ yeni
    ownerPass: document.getElementById("ownerPass").value.trim(),
    name: document.getElementById("name").value.trim(),
    birthYear: document.getElementById("birthYear").value,
    blood: document.getElementById("blood").value,
    illness: document.getElementById("illness").value.trim(),
    meds: document.getElementById("meds").value.trim(),
    allergy: document.getElementById("allergy").value.trim(),
    emergency: document.getElementById("emergency").value.trim()
  }

  try{
    const res = await fetch("https://acilbi.com/save?id="+id,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data)
    })

    const text = await res.text()
    if(res.ok){
      status.className="small ok"
      status.innerText="‚úÖ Bilgiler kaydedildi"
    }else{
      status.className="small err"
      status.innerText=text
    }
  }catch(e){
    status.className="small err"
    status.innerText="Baƒülantƒ± hatasƒ±"
  }

  btn.disabled = false
}
</script>

</body>
</html>
